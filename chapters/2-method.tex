\chapter{Method} \label{ch:method}
The following chapter describes the method applied in this thesis. It is based on a seven-step process to penetration testing by \textcite{weidman2014}. In the first part, this method is described. That is followed by how each of these seven steps was applied in this thesis. Furthermore, for the threat modeling phase, a technique outlined by \textcite{guzman2017iot} was used. This threat modeling process is also described below.

\section{Penetration Testing methodology} \label{ch:method:pentest}
In their book \citetitle{weidman2014}, \citeauthor{weidman2014} details a seven-step process for penetration testing \cite{weidman2014}. This section firstly gives a brief description of all seven steps and lastly outlines how each step was performed in this thesis. Included in \citeauthor{weidman2014}'s method for penetration testing are the following seven steps:
\begin{enumerate}
    \item \textit{Pre-engagement}. This step involves communicating with the party that ordered the penetration test to be done. The goal of this step is to make sure both parties are on the same page and understanding of how the tests will be done. Things to agree upon, according to \citeauthor{weidman2014}, are scope, testing window, and clear authorization from the other party that you are legally allowed to assess the security of their system.
    \item \textit{Information Gathering}. This step includes what is known as \gls{OSINT}. \gls{OSINT} is the process of using publicly available sources of information to gather information about the system in question, a widely used technique in computer security. These sources include search engines like Google, news articles, public government data, academic papers, etc, \cite{steele2007open}. One might also use port scanners like \textit{Nmap}\footnotelink{https://nmap.org/}{2021-03-29} and other application scanners to gather information about the system. Additionally, one might listen in on the network traffic of the system to gain an understanding of its behavior, using tools like \textit{WireShark}\footnotelink{https://www.wireshark.org/}{2021-04-01} for example.
    \item \textit{Threat Modeling}. This step involves mapping out the components of the system, based on the information from the previous step. From that, you think of potential attacks and vulnerabilities of the system, their potential impact, and the likelihood of success. There are many different threat modeling techniques. More on this and the technique used in this report in section \ref{ch:method:threat-modeling}.
    \item \textit{Vulnerability Analysis}. This step involves actively pentesting the system to discover vulnerabilities. This can be done for example by manually probing the system or by using vulnerability scanners like \textit{Metasploit}\footnotelink{https://www.metasploit.com/}{2021-03-29}, \textit{Burp Suite}\footnotelink{https://portswigger.net/burp}{2021-03-29}, or \textit{Nessus}\footnotelink{https://www.tenable.com/products/nessus}{2021-03-29}.
    \item \textit{Exploitation}. This step involves exploiting the vulnerabilities discovered in the previous step. By exploiting these, the goal is to perform some malicious act on the system to subvert its security.
    \item \textit{Post Exploitation}. After a successful exploit, this step involves analyzing the consequences. If the exploit involves access to a machine one might investigate the file system, look for possibilities of privilege escalation, etc. One asks how severe this successful exploit is to the overall security of the system.
    \item \textit{Reporting}. This final step involves summarizing the findings to the interested party. Crucially, if the findings are to be publicized one should adhere to the principle of responsible disclosure.
\end{enumerate}
What follows is a description of how each step above was applied in this thesis.

\subsection{Pre-engagement}
According to \citeauthor{weidman2014}'s method, the pre-engagement step is done in collaboration with the client. In this project, however, there is no clear client except the author and perhaps KTH and FÃ¶rsvarsmakten. The scope and expectations were continuously discussed during the course of the project. The companies behind the system (see \ref{fig:company-structure}) were not informed of the security analysis until after the project was finalized. Securitas, the seller of the system was contacted multiple times over the phone via their customer support to verify the legality of security testing the system but were not informed of the security assessment until after the thesis was finished.

\subsection{Information Gathering}
The information-gathering phase was done in several steps, the first one being \gls{OSINT}. Initially, the model number of all devices was gathered from either physical labels on the peripherals or from Securitas' website\footnotelink{https://www.securitashome.se/}{2021-03-29}. Using the search engine Google, the devices and their manufacturer \textit{Climax Technology} were quickly identified. From their website much more information about the system could be found, such as how the peripherals communicate and their proprietary \gls{RF} protocol\footnotelink{https://www.climax.com.tw/new/f1-features-new.php}{2021-03-29}. An additional resource was finding each component's FCC ID\footnotelink{https://www.fcc.gov/oet/ea/fccid}{2021-03-30}, from which one can find user manuals submitted to the FCC agency, official testing documentation, and more via \textit{fccid.io}, see chapter \ref{ch:system}.

\subsection{Threat Modeling}
Threat modeling involves building a thorough picture of the system and identifying all possible threats to the system. There are many different threat modeling techniques. The threat modeling technique used in this thesis is one outlined in the book \citetitle{guzman2017iot}. In their book, authors \citeauthor{guzman2017iot}, describe a threat modeling technique for IoT devices, which features a six step process \cite{guzman2017iot}. This threat modeling technique is applied in this thesis. More on this in section \ref{ch:method:threat-modeling}. The threat model is presented in chapter \ref{ch:threat-model}.

\subsection{Vulnerability Analysis}
The next step of the methodology involves taking the threats identified in the threat model and trying to find which of them present actual security vulnerabilities in the system. The way this was done varied greatly depending on the type of threat that was examined. For the threats relating to \gls{RF} communication, for example, this involved physically capturing radio signals using a \gls{SDR}. For other threats, like investigating insecure network services, this involved using vulnerability scanners like \textit{Nmap}\footnotelink{https://nmap.org/}{2021-05-30}. Additionally, manual analysis was a big part of most of the vulnerability analysis. More about the practical penetration testing methods used in this thesis can be found in chapter \ref{ch:pentesting}, under the method section of each penetration test.

\subsection{Exploitation}
After a certain vulnerability in the system was confirmed, attempts to exploit the vulnerability were made. These were done to try and assess the consequences of the vulnerability and what type of results an attacker could achieve by exploiting this vulnerability.

\subsection{Post Exploitation}
Several vulnerabilities were found as a result of the previous two steps. However, none of them presented any opportunities for post-exploitation. As such, this section of the penetration testing methodology was not applied in this thesis.

\subsection{Reporting}
The identified vulnerabilities were reported to Securitas. Responsible disclosure was applied using the method of Coordinated Vulnerability Disclosure (CVD) \cite{disclosure-guideline}. This is a process that aims to both handle the vulnerability responsibly and let the manufacturer produce a security patch, while at the same time making sure the vulnerability is publicly disclosed so as to increase the collective knowledge of our society within cybersecurity and make sure consumers can make an informed decision.

Securitas was contacted through their customer support, as they do not publish any way to report security vulnerabilities on their website. They were given 90 days to fix and respond to the vulnerability before the report was published, as is the industry standard. However, the thesis presentation was held before that, as that was a requirement from KTH. Due to the nature of the identified vulnerabilities, withholding information on how to perform them was not possible during the presentation. Instead, participants were asked to not spread the information further until the thesis was published.

\section{Threat modeling for IoT devices} \label{ch:method:threat-modeling}
Threat modeling is a wide field. According to authors \citeauthor{XIONG201953} the field lacks a common ground \cite{XIONG201953}. There are competing definitions of the term, and they conclude that it is used in many different and sometimes competing ways. However, the definition used in this report is the following, as suggested in their report: \enquote{threat modeling is a process that can be used to analyze potential attacks or threats, and can also be supported by threat libraries or attack taxonomies}. The authors also note that there are two categories of threat models, \textit{manual/automatic} and \textit{formal/graphical} threat modeling. The former category is applied in this thesis. Lastly, some threat models aim to be general and others more specific to the type of system examined \citeauthor{XIONG201953}. This thesis uses a threat modeling technique of the latter category, which is specified towards IoT systems.

In their book \citetitle{guzman2017iot}, authors \citeauthor{guzman2017iot}, outline a six-step process for threat modeling IoT devices. This is the threat modeling technique applied in this thesis, the result of which can be found in chapter \ref{ch:threat-model}. There are many different threat modeling techniques and this one was chosen due to it being customized specifically for IoT devices. Here are the six steps of the process listed and described:
\begin{enumerate}
    \item \textit{Identify IoT assets}. This initial step involves identifying all assets of the system you have an interest in protecting. Essentially, this list should include anything that could be a target or something negatively affected by an attack. This aids in identifying what an attacker might focus on when crafting an attack or pentesting the system. Can be presented as a simple table describing each asset.
    
    \item \textit{Create an IoT Device Architecture Overview}. Once all assets have been identified, the next step involves creating an architecture overview. In their method, \citeauthor{guzman2017iot} includes three components of this breakdown. First is a list of all use cases of the system. This details what a regular user can do with the system and the steps of each. Second is a diagram of all components of the system, and how they communicate (what protocol for example). Components can include everything from external cloud servers, network equipment, and individual processes running on a machine. This is usually presented visually, in a diagram depicting the system. Lastly, a list of all identified technologies used in the system is included. This list should include everything from operating systems, network protocols, and known applications. Any additional information about each, such as version number, for example, should be included if known.
    
    \item \textit{Decompose the IoT Device}. This step includes analyzing the application and protocol data flow of the system. Using this, one aims to locate and detail all potentially vulnerable entry points of the system, either into physical devices or client applications. Additionally, entry points of higher privilege access should be noted. An entry point could for example be a hosted web server on an IoT device or an open TCP port, the firmware of the device, or a mobile application.
    
    \item \textit{Identify Threats}. In this phase, the threats to the system are identified. The documented data flows aid you in identifying potential threats. One can use a model of threats like STRIDE \cite{stride} to identify threats of different characteristics, see section \ref{ch:method:stride}. In their method, \citeauthor{guzman2017iot} proposes adding two categories to the STRIDE model for IoT-specific threats. The first one is \textit{Physical Security Bypass}, which involves vulnerabilities caused by the attacker having physical access to the device for a limited period of time. The second category is \textit{Supply Chain Issues}, which includes threats to the various technologies that the system relies on. This could be documented vulnerabilities in the hardware platform for example. Note that due to the delimitations of this report (see section \ref{ch:intro:delimitations}) the former introduced category is not included in this thesis.
    
    \item \textit{Document Threats}. A few of the identified threat use cases will be documented in this step. For each, the target of the threat, the attack technique, and the potential countermeasures should be noted.
    
    \item \textit{Rate the Threats}. For each documented threat, one rates its severity. The authors propose using a system like DREAD to give a score to each threat, based on a few different criteria like damage potential and reproducibility.
\end{enumerate}
The authors suggest as a final step rating the threats using the DREAD model. However, due to the time constraints of this project that was deemed excessive. There were more promising identified threats than there was time to explore them all within the scope of this thesis. Therefore, intuition was relied up on to determine which threats to explore by answering the following questions:
\begin{itemize}
    \item How likely is it that the threat can be successfully exploited?
    \item What is the potential impact of the system being vulnerable to the threat?
\end{itemize}

\section{The STRIDE model} \label{ch:method:stride}
STRIDE is a model of threats used to identify and categorize threats to the cybersecurity of an IT system \cite{stride}. It was initially developed by Praerit Garg and Loren Kohnfelder at Microsoft as part of their threat modeling technique. It is a widely used mnemonic in the security industry to aid in recognizing threats\footnotelink{https://docs.microsoft.com/en-us/azure/security/develop/threat-modeling-tool-threats}{2021-03-29}. The following are the six properties that make up the acronym and a description of each:
\begin{itemize}
    \item \textbf{Spoofing Identity}. This means impersonating the identity of another user or component of the system. One example is obtaining a user's login credentials and posing as that user, or performing a \textit{Man in the middle} attack and posing as an external trusted server.
    
    \item \textbf{Tampering with Data}. This means modifying data in the system in a malicious manner that you were perhaps not meant to modify. An example is unauthorized modifications to data stored in a database.
    
    \item \textbf{Repudiation}. This means being able to claim you did not perform a certain action. An example would be to somehow be able to claim a transaction did not go through, thereby illegally receiving additional payment, or deleting log files.
    
    \item \textbf{Information Disclosure}. This means exposing information or data to users who are not meant to have access to it. An example is a database leak.
    
    \item \textbf{Denial of Service}. This means denying access to a service. An example is making a web server unavailable to users by hitting it with heavy traffic, perhaps via a distributed \gls{DOS} attack.
    
    \item \textbf{Elevation of Privilege}. This means an unprivileged user gaining privileged access to the system, allowing them access to features of the system they were not meant to. An example is exploiting a vulnerability in a program or kernel to get access as a more privileged user on the machine like \texttt{root}.
\end{itemize}
In conjunction with the OWASP top ten list of vulnerabilities in IoT systems and the ETSI EN 303 645 standard (see sections \ref{ch:related-work:owasp} and \ref{ch:related-work:etsi}), this model was used to identify and categorize the threats against the system. This is presented in section \ref{ch:threat-model:threats}.
