\chapter{Method} \label{ch:method}
The following chapter describes the method applied in this report. It is based on a seven-step process to penetration testing by \textcite{weidman2014}. In the first part, this method is described. That is followed by how each of these seven steps was applied in this thesis. Additionally, for the threat modeling phase, a method outlined by \textcite{guzman2017iot} was used. This threat modeling process is described below.

\section{Penetration Testing methodology}
In their book \citetitle{weidman2014}, \citeauthor{weidman2014} details a seven-step process for penetration testing \cite{weidman2014}. This section firstly gives a brief description of all seven steps and lastly outlines how each step was performed in this thesis. Included in \citeauthor{weidman2014}'s method for penetration testing are the following seven steps:
\begin{enumerate}
    \item \textit{Pre-engagement}. This step involves communicating with the party that ordered the penetration test to be done. The goal of this step is to make sure both parties are on the same page and understanding of how the tests will be done. Things to agree upon, according to \citeauthor{weidman2014}, are scope, testing window, and clear authorization from the other party that you are legally allowed to assess the security of their system.
    \item \textit{Information Gathering}. This step includes what is known as \gls{OSINT}. \gls{OSINT} is the process of using publicly available sources of information to gather information about the system in question, a widely used technique in computer security. These sources include search engines like Google, news articles, public government data, academic papers, etc, \cite{steele2007open}. One might also use port scanners like \textit{Nmap}\footnotelink{https://nmap.org/}{2021-03-29} and other application scanners to gather information about the system. Additionally, one might listen in on the network traffic of the system to gain an understanding of its behavior, using tools like \textit{WireShark}\footnotelink{https://www.wireshark.org/}{2021-04-01} for example.
    \item \textit{Threat Modeling}. This step involves mapping out the components of the system, based on the information from the previous step. From that, you think of potential attacks and vulnerabilities of the system, their potential impact, and the likelihood of success. There are many different threat modeling techniques. More on this and the technique used in this report in section \ref{ch:method:threat-modeling}.
    \item \textit{Vulnerability Analysis}. This step involves actively pentesting the system to discover vulnerabilities. This can be done for example by manually probing the system or by using vulnerability scanners like \textit{Metasploit}\footnotelink{https://www.metasploit.com/}{2021-03-29}, \textit{Burp Suite}\footnotelink{https://portswigger.net/burp}{2021-03-29}, or \textit{Nessus}\footnotelink{https://www.tenable.com/products/nessus}{2021-03-29}.
    \item \textit{Exploitation}. This step involves exploiting the vulnerabilities discovered in the previous step. By exploiting these, the goal is to perform some malicious act on the system to subvert its security.
    \item \textit{Post Exploitation}. After a successful exploit, this step involves analyzing the consequences. If the exploit involves access to a machine one might investigate the file system, look for possibilities of privilege escalation, etc. One asks how severe this successful exploit is to the overall security of the system.
    \item \textit{Reporting}. This final step involves summarizing the findings to the interested party. Crucially, if the findings are to be publicized one should adhere to the principle of responsible disclosure.
\end{enumerate}
What follows is a description of how each step above was applied in this thesis.

\subsection{Pre-engagement}
According to \citeauthor{weidman2014}'s method, the pre-engagement step is done in collaboration with the client. In this project, however, there is no clear client except the author and perhaps KTH and FÃ¶rsvarsmakten. The scope and expectations were continuously discussed during the course of the project. The companies behind the system (see \ref{fig:company-structure}) were not informed of the security analysis until after the project was finalized. Securitas, the seller of the system was contacted multiple times over the phone via their customer support to verify the legality of security testing the system.

\subsection{Information Gathering}
The information-gathering phase was done in several steps, the first one being \gls{OSINT}. Initially, the model number of all devices was gathered from either physical labels on the peripherals or from Securitas' website\footnotelink{https://www.securitashome.se/}{2021-03-29}. Using the search engine Google, the devices and their manufacturer \textit{Climax Technology} were quickly identified. From their website much more information about the system could be found, such as how the peripherals communicate and their proprietary \gls{RF} protocol\footnotelink{https://www.climax.com.tw/new/f1-features-new.php}{2021-03-29}. An additional resource was finding each component's FCC ID\footnotelink{https://www.fcc.gov/oet/ea/fccid}{2021-03-30}, from which one can find user manuals submitted to the FCC agency, official testing documentation, and more via \textit{fccid.io}, see chapter \ref{ch:system}.

\subsection{Threat Modeling}
Threat modeling involves building a thorough picture of the system and identifying all possible threats to the system. There are many different threat modeling techniques. The threat modeling technique used in this thesis is one outlined in the book \citetitle{guzman2017iot}. In their book, authors \citeauthor{guzman2017iot}, describe a threat modeling technique for IoT devices, which features a 6 step process \cite{guzman2017iot}. This threat modeling technique is applied in this thesis. More on this in section \ref{ch:method:threat-modeling}. The threat model is presented in chapter \ref{ch:threat-model}.

\subsection{Vulnerability Analysis}
The next step in the methodology involves taking the threats identified in the threat model and trying to find which of them present actual security vulnerabilities in the system. The way this was done varied greatly depending on the type of threat that was examined. For the threats relating to \gls{RF} communicatio, for example, this involved physically capturing radio signals using a \gls{SDR}. For other threats, like investigating insecure network services, this involved using vulnerability scanners like \textit{Nmap}\footnotelink{https://nmap.org/}{2021-05-30}. Additionally, manual analysis was a big part of most of the vulnerability analysis. More about the practical penetration testing methods used in this thesis can be found in chapter \ref{ch:pentesting}, under the method section of each penetration test.

\subsection{Exploitation}
\todo

\subsection{Post Exploitation}
Many vulnerabilities were found was a result of the previous two steps. However, none of them presented any opportunities for post exploitation. As such, this section of the pentesting methodology was not applied in this thesis.

\subsection{Reporting}
\todo

\section{Threat modeling for IoT devices} \label{ch:method:threat-modeling}
In their book \citetitle{guzman2017iot}, authors \citeauthor{guzman2017iot}, outline a six-step process for threat modeling IoT devices. This is the threat modeling technique applied in this thesis, the result of which can be found in chapter \ref{ch:threat-model}. There are many different threat modeling techniques and this one was chosen due to it being customized specifically for IoT devices. Here are the six steps of the process listed and described:
\begin{enumerate}
    \item \textit{Identify IoT assets}. This initial step involves identifying all assets of the system you have an interest in protecting. Essentially, this list should include anything that could be a target or something negatively affected by an attack. This aids in identifying what an attacker might focus on when crafting an attack or pentesting the system. Can be presented as a simple table describing each asset.
    \item \textit{Create an IoT Device Architecture Overview}. Once all assets have been identified, the next step involves creating an architecture diagram. In their method, \citeauthor{guzman2017iot} includes three components of this architecture breakdown. First is a list of all use cases of the system. This details what a regular user can do with the system and the steps of each. Second is a diagram of all components of the system, and how they communicate (what protocol for example). Components can include everything from external cloud servers, network equipment, and individual processes. This is usually presented visually, in a diagram depicting the system. Lastly, a list of all identified technologies used in the system is included. This list should include everything from operating systems, network protocols, and known applications. Any additional information about each, such as version number, for example, should be included if known.
    \item \textit{Decompose the IoT Device}. This step includes analyzing the application and protocol data flow of the system. Using this, one aims to locate vulnerable entry points of the system, either into physical devices or client applications. Additionally, entry points of higher privilege access should be noted and every single entry point of the system identified. An entry point could for example be a hosted web server on an IoT device or an open TCP port, the firmware of the device, or a mobile application.
    \item \textit{Identify Threats}. In this phase, the threats to the system are identified. The documented data flows aid you in identifying potential threats. One can use a model of threats like STRIDE \cite{stride} to identify threats of different characteristics, see section \ref{ch:method:stride}. In their method, \citeauthor{guzman2017iot} proposes adding two categories to the STRIDE model for IoT-specific threats. The first one is \textit{Physical Security Bypass}, which involves vulnerabilities caused by the attacker having physical access to the device for a limited period of time. The second category is \textit{Supply Chain Issues}, which includes threats to the various technologies that the system relies on. This could be documented vulnerabilities in the hardware platform for example. Note that due to the delimitations of this report (see section \ref{ch:intro:delimitations}) the former introduced category is not included in this thesis.
    \item \textit{Document Threats}. A few of the identified threat use cases will be documented in this step. For each, the target of the threat, the attack technique, and the potential countermeasures should be noted.
    \item \textit{Rate the Threats}. For each documented threat, one rates its severity. The authors propose using a system like DREAD to give a score to each threat, based on a few different criteria like damage potential and reproducibility.
\end{enumerate}

\section{OWASP IoT Top 10} \label{ch:method:owasp}
The OWASP top 10 for web vulnerabilities is one of the most used sources of the most common web vulnerabilities \cite{owasp-www-top10}. The OWASP Foundation, the publisher of the report, claims it is \enquote{globally recognized by developers as the first step towards more secure coding}\footnotelink{https://owasp.org/www-project-top-ten/}{2021-05-21}. OWASP also compiles and publishes a list of the top ten most common vulnerabilities for specifically IoT systems \cite{owasp-iot-top10}. The latest revision was released in \citeyear{owasp-iot-top10}. This list is highly relevant to this report as the system in question is an IoT system. It was used to identify and determine the most important threats to investigate. The top ten vulnerabilities for IoT systems according to OWASP's report are the following, in order of importance:
\begin{enumerate}
    \item \textbf{Weak, Guessable, or Hardcoded Passwords}. This includes passwords that can be easily brute-forced, are publicly available, or unchangeable. Famously the MIRAI botnet, which mostly included IoT devices, managed to recruit over half a million devices to its botnet by testing just 60 default credentials \cite{understanding-mirai}.
    
    \item \textbf{Insecure Network Services}. Often unneeded network services will be left open on IoT devices, even after they are shipped to customers. Commonly, these are used during development but are never removed when the device is shipped. An example is open telnet services or ssh being left open, leaving a backdoor open for the manufacturer. However, these network services also open the device up to a whole slew of potential vulnerabilities and are often completely unnecessary for the functionality of the IoT system. A real-world example of this is again the MIRAI botnet, which scanned IP ranges for devices with telnet services hosted on port 21 or 2121 \cite{understanding-mirai}.
    
    \item \textbf{Insecure Ecosystem Interfaces}. Many IoT systems are much more than just the device itself. There is often an entire infrastructure behind it to control and interact with the system, such as a mobile application or a website, with an accompanying backend API server. Vulnerabilities anywhere in this ecosystem can lead to the security of the IoT device itself being compromised.
    
    \item \textbf{Lack of Secure Update Mechanism}. To add new features and to fix security issues, updating the firmware of IoT devices is often unavoidable. However, over-the-air (OTA) firmware updates add an additional attack vector and can introduce many potential security issues. This can include the device not validating the firmware it receives, delivering the firmware unencrypted in transit, a lack of a mechanism to prevent rolling back changes, and a lack of notifications of security changes due to updates.
    
    \item \textbf{Use of Insecure or Outdated Components}. This means using old versions of libraries and components that themselves are vulnerable. These can then in turn compromise the security of the system as a whole. This can include everything from insecure versions of operating systems, insecure customization of the OS, third-party software, and insecure hardware components from higher up in the supply chain.
    
    \item \textbf{Insufficient Privacy Protection}. This refers to the user's personal information being stored in an insecure way. Either on the IoT system itself or in the larger ecosystem.
    
    \item \textbf{Insecure Data Transfer and Storage}. Lack of encryption or proper access control, both in transit and in storage. This can, once again, be both on the IoT device and anywhere else in the larger ecosystem.
    
    \item \textbf{Lack of Device Management}. This includes lack of secure asset management, update management, secure decommissioning of the system, proper monitoring of the system, as well as capabilities to respond to a security issue.
    
    \item \textbf{Insecure Default Settings}. This refers to the device being sold with insecure default settings. Often the user is never prompted or encouraged to change these insecure defaults.
    
    \item \textbf{Lack of Physical Hardening}. During development, debug hardware interfaces are used. However, a common vulnerability is not removing these before shipping the product. This can include open JTAG or UART interfaces on the circuit board, allowing for the extraction of the firmware or even terminal access to the system over a serial interface. Often these vulnerabilities require physical access to the system. However, they can be used to extract valuable information which can help an attacker in developing remote exploits.
\end{enumerate}
Note that some of these threats were not considered in this report. Some of these fall under the delimited areas described in section \ref{ch:intro:delimitations}, such as number three for example, and others were not considered simply due to time constraints. However, the OWASP IoT top 10 list was the basis for all identified threats against the system, along with the STRIDE model described in the following section.

\section{The STRIDE model} \label{ch:method:stride}
STRIDE is a model of threats used to identify threats to the cybersecurity of an IT system \cite{stride}. It was initially developed by Praerit Garg and Loren Kohnfelder at Microsoft as part of their threat modeling technique. It is a widely used mnemonic in the security industry to aid in recognizing threats\footnotelink{https://docs.microsoft.com/en-us/azure/security/develop/threat-modeling-tool-threats}{2021-03-29}. The following are the six properties that make up the acronym and a description of each:
\begin{itemize}
    \item \textbf{Spoofing Identity}. This means impersonating the identity of another user or component of the system. One example is obtaining a user's login credentials and posing as that user, or performing a \textit{Man in the middle} attack and posing as an external trusted server.
    \item \textbf{Tampering with Data}. This means modifying data in the system in a malicious manner that you were perhaps not meant to modify. An example is unauthorized modifications to data stored in a database.
    \item \textbf{Repudiation}. This means being able to claim you did not perform a certain action. An example would be to somehow be able to claim a transaction did not go through, thereby illegally receiving additional payment.
    \item \textbf{Information Disclosure}. This means exposing information or data to users who are not meant to have access to it. An example is a database leak.
    \item \textbf{Denial of Service}. This means denying access to a service. An example is making a web server unavailable to users by hitting it with heavy traffic, perhaps via a distributed \gls{DOS} attack.
    \item \textbf{Elevation of Privilege}. This means an unprivileged user gaining privileged access to the system, allowing them access to features of the system they were not meant to. An example is exploiting a vulnerability in a program or kernel to get access as a more privileged user on the machine (like root).
\end{itemize}
In conjunction with the OWASP top ten list of vulnerabilities in IoT systems, this model was used to identify and categorize the threats against the system. This is presented in section \ref{ch:threat-model:threats}.
